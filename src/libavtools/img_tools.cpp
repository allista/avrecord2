/***************************************************************************
 *   Copyright (C) 2006 by Allis   *
 *   allista@gmail.com   *
 *                                                                         *
 *   This program is free software; you can redistribute it and/or modify  *
 *   it under the terms of the GNU General Public License as published by  *
 *   the Free Software Foundation; either version 2 of the License, or     *
 *   (at your option) any later version.                                   *
 *                                                                         *
 *   This program is distributed in the hope that it will be useful,       *
 *   but WITHOUT ANY WARRANTY; without even the implied warranty of        *
 *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         *
 *   GNU General Public License for more details.                          *
 *                                                                         *
 *   You should have received a copy of the GNU General Public License     *
 *   along with this program; if not, write to the                         *
 *   Free Software Foundation, Inc.,                                       *
 *   59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.             *
 ***************************************************************************/

// C++ Interface: img_tools

#include <ctype.h>
#include <list>
using namespace std;

#include "img_tools.h"

//highest ascii value is 126 (~)
const uint8_t ASCII_MAX = 127;

struct s_bitmap
{
	unsigned char ascii;
	unsigned char pix[8][7];
};

struct b_bitmap
{
	unsigned char ascii;
	unsigned char pix[16][14];
};

//table of small bitmaps of all printable ASCII chars
s_bitmap s_table[]= {
                        {
                            ' ',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '0',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,2,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,2,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '1',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '2',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {0,1,1,2,2,1,0},
                                {0,1,2,1,1,0,0},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,1,1,0}
                            }
                        },
                        {
                            '3',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {0,1,1,2,2,1,0},
                                {0,1,0,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '4',
                            {
                                {0,0,0,0,1,0,0},
                                {0,0,0,1,2,1,0},
                                {0,0,1,2,2,1,0},
                                {0,1,2,1,2,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,2,1,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,0,1,0,0}
                            }
                        },
                        {
                            '5',
                            {
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,2,0},
                                {0,1,1,1,1,2,0},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            '6',
                            {
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '7',
                            {
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,1,2,1},
                                {0,0,0,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,1,0,0,0},
                                {0,1,2,1,0,0,0},
                                {0,0,1,0,0,0,0}
                            }
                        },
                        {
                            '8',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '9',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {0,1,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '"',
                            {
                                {0,0,1,0,1,0,0},
                                {0,1,2,1,2,1,0},
                                {0,1,2,1,2,1,0},
                                {0,0,1,0,1,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '/',
                            {
                                {0,0,0,0,1,0,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,1,0,0,0},
                                {0,1,2,1,0,0,0},
                                {0,0,1,0,0,0,0}
                            }
                        },
                        {
                            '(',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,1,0,0,0},
                                {0,1,2,1,0,0,0},
                                {0,1,2,1,0,0,0},
                                {0,1,2,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            ')',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            '@',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,2,2,2,1},
                                {1,2,1,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            '~',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,0,0,0,0},
                                {0,1,2,1,0,1,0},
                                {1,2,1,2,1,2,1},
                                {0,1,0,1,2,1,0},
                                {0,0,0,0,1,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '#',
                            {
                                {0,0,1,0,1,0,0},
                                {0,1,2,1,2,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,2,1,2,1,0},
                                {0,1,2,1,2,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,0,1,0,0}
                            }
                        },
                        {
                            '<',
                            {
                                {0,0,0,0,0,1,0},
                                {0,0,0,1,1,2,1},
                                {0,1,1,2,2,1,0},
                                {1,2,2,1,1,0,0},
                                {0,1,1,2,2,1,0},
                                {0,0,0,1,1,2,1},
                                {0,0,0,0,0,1,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '>',
                            {
                                {0,1,0,0,0,0,0},
                                {1,2,1,1,0,0,0},
                                {0,1,2,2,1,1,0},
                                {0,0,1,1,2,2,1},
                                {0,1,2,2,1,1,0},
                                {1,2,1,1,0,0,0},
                                {0,1,0,0,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '|',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            ',',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,0,0,0},
                                {0,1,2,2,1,0,0},
                                {0,1,2,2,1,0,0},
                                {0,1,2,1,0,0,0},
                                {0,0,1,0,0,0,0}
                            }
                        },
                        {
                            '.',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,0,0,0},
                                {0,1,2,2,1,0,0},
                                {0,1,2,2,1,0,0},
                                {0,0,1,1,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            ':',
                            {
                                {0,0,1,1,0,0,0},
                                {0,1,2,2,1,0,0},
                                {0,1,2,2,1,0,0},
                                {0,0,1,1,0,0,0},
                                {0,0,1,1,0,0,0},
                                {0,1,2,2,1,0,0},
                                {0,1,2,2,1,0,0},
                                {0,0,1,1,0,0,0}
                            }
                        },
                        {
                            '-',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '+',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            '_',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,1,1,0}
                            }
                        },
                        {
                            '\'',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0}
                            }
                        },
                        {
                            'a',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,1,0}
                            }
                        },
                        {
                            'b',
                            {
                                {0,1,0,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'c',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {1,2,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,1,0}
                            }
                        },
                        {
                            'd',
                            {
                                {0,0,0,0,0,1,0},
                                {0,0,0,0,1,2,1},
                                {0,0,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,1,0}
                            }
                        },
                        {
                            'e',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,2,1,1,2,1},
                                {1,2,1,2,2,1,0},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,1,0}
                            }
                        },
                        {
                            'f',
                            {
                                {0,0,0,0,1,1,0},
                                {0,0,0,1,2,2,1},
                                {0,0,1,2,1,1,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            'g',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {0,1,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'h',
                            {
                                {0,1,0,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,1,1,0,0},
                                {1,2,1,2,2,1,0},
                                {1,2,2,1,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'i',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'j',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,1,2,1,0,0},
                                {1,2,2,1,0,0,0},
                                {0,1,1,0,0,0,0}
                            }
                        },
                        {
                            'k',
                            {
                                {0,1,0,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,0,1,0,0},
                                {1,2,1,1,2,1,0},
                                {1,2,1,2,1,0,0},
                                {1,2,2,1,2,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'l',
                            {
                                {0,0,1,1,0,0,0},
                                {0,1,2,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,0,1,0,0}
                            }
                        },
                        {
                            'm',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,1,0,1,0,0},
                                {1,2,2,1,2,1,0},
                                {1,2,1,2,1,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,1,2,1,2,1},
                                {0,1,0,1,0,1,0}
                            }
                        },
                        {
                            'n',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,1,1,0,0},
                                {1,2,1,2,2,1,0},
                                {1,2,2,1,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'o',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'p',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,0,0},
                                {1,2,1,0,0,0,0},
                            }
                        },
                        {
                            'q',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,2,1},
                                {0,0,0,0,1,2,1}
                            }
                        },
                        {
                            'r',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,1,1,0,0},
                                {1,2,1,2,2,1,0},
                                {1,2,2,1,1,2,1},
                                {1,2,1,0,0,1,0},
                                {1,2,1,0,0,0,0},
                                {0,1,0,0,0,0,0}
                            }
                        },
                        {
                            's',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,2,2,1,1,0},
                                {0,1,1,2,2,2,1},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            't',
                            {
                                {0,0,0,1,0,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,2,1,0},
                                {0,0,0,0,1,0,0}
                            }
                        },
                        {
                            'u',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,2,2,1},
                                {0,1,2,2,1,2,1},
                                {0,0,1,1,0,1,0}
                            }
                        },
                        {
                            'v',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            'w',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,2,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,0,1,0,0}
                            }
                        },
                        {
                            'x',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,0,1,0,0},
                                {1,2,1,1,2,1,0},
                                {0,1,2,2,1,0,0},
                                {0,1,2,2,1,0,0},
                                {1,2,1,1,2,1,0},
                                {0,1,0,0,1,0,0}
                            }
                        },
                        {
                            'y',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,1,0,0,0},
                                {1,2,1,0,0,0,0}
                            }
                        },
                        {
                            'z',
                            {
                                {0,0,0,0,0,0,0},
                                {0,0,0,0,0,0,0},
                                {0,1,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {0,1,1,2,1,0,0},
                                {0,1,2,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'A',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'B',
                            {
                                {0,1,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'C',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,0,0,1,0},
                                {1,2,1,0,0,1,0},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'D',
                            {
                                {0,1,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'E',
                            {
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,0,0},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,1,1,0}
                            }
                        },
                        {
                            'F',
                            {
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {0,1,0,0,0,0,0}
                            }
                        },
                        {
                            'G',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,1,0},
                                {1,2,1,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'H',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'I',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'J',
                            {
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,2,1},
                                {0,0,0,0,1,2,1},
                                {0,1,0,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'K',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,2,1,0},
                                {1,2,1,2,1,0,0},
                                {1,2,2,2,1,0,0},
                                {1,2,1,1,2,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'L',
                            {
                                {0,1,0,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'M',
                            {
                                {0,1,1,0,1,1,0},
                                {1,2,2,1,2,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,1,1,1,2,},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'N',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,2,1,1,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,1,1,2,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'O',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,0,0}
                            }
                        },
                        {
                            'P',
                            {
                                {0,1,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,0,0},
                                {1,2,1,0,0,0,0},
                                {1,2,1,0,0,0,0},
                                {0,1,0,0,0,0,0}
                            }
                        },
                        {
                            'Q',
                            {
                                {0,0,1,1,1,0,0},
                                {0,1,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,1,1,2,1,0},
                                {0,1,2,2,1,2,1},
                                {0,0,1,1,0,1,0}
                            }
                        },
                        {
                            'R',
                            {
                                {0,1,1,1,1,0,0},
                                {1,2,2,2,2,1,0},
                                {1,2,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {1,2,1,2,1,0,0},
                                {1,2,1,1,2,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'S',
                            {
                                {0,0,1,1,1,1,0},
                                {0,1,2,2,2,2,1},
                                {1,2,1,1,1,1,0},
                                {0,1,2,2,2,1,0},
                                {0,0,1,1,1,2,1},
                                {0,1,1,1,1,2,1},
                                {1,2,2,2,2,1,0},
                                {0,1,1,1,1,0,0}
                            }
                        },
                        {
                            'T',
                            {
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,2,1,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            'U',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {0,1,2,2,2,2,1},
                                {0,0,1,1,1,1,0}
                            }
                        },
                        {
                            'V',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            'W',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {1,2,1,0,1,2,1},
                                {1,2,1,1,1,2,1},
                                {1,2,1,2,1,2,1},
                                {1,2,1,2,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,0,1,0,0}
                            }
                        },
                        {
                            'X',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,1,2,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,0,0,0,1,0}
                            }
                        },
                        {
                            'Y',
                            {
                                {0,1,0,0,0,1,0},
                                {1,2,1,0,1,2,1},
                                {0,1,2,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,1,2,1,0,0},
                                {0,0,0,1,0,0,0}
                            }
                        },
                        {
                            'Z',
                            {
                                {0,1,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,2,1,0},
                                {0,0,1,2,1,0,0},
                                {0,1,2,1,0,0,0},
                                {1,2,1,1,1,1,0},
                                {1,2,2,2,2,2,1},
                                {0,1,1,1,1,1,0}
                            }
                        }
                    };

//table of big bitmaps of all printable ASCII chars
b_bitmap b_table[sizeof(s_table)/sizeof(s_bitmap)];

//tables of pointers to bitmaps of all ASCII chars.
//unprintable chars treated as spaces
unsigned char *s_chars[ASCII_MAX];
unsigned char *b_chars[ASCII_MAX];

void InitBitmaps()
{
	unsigned int i=0, x, y;

	/* Fill the structure 'b_table' with double sized characters. */
	while(s_table[i].ascii)
	{
		b_table[i].ascii = s_table[i].ascii;
		for(x=0; x < 14; x++)
			for(y=0; y < 16; y++)
				b_table[i].pix[y][x] = s_table[i].pix[y/2][x/2];
		i++;
	}

	/* first init all char ptr's to a space character */
	for(i=0; i < ASCII_MAX; i++)
	{
		s_chars[i]=&s_table[0].pix[0][0];
		b_chars[i]=&b_table[0].pix[0][0];
	}

	/* build [big_]char_arr_ptr table to point to each available ascii */
	for(i=0; i < LEN(s_table); i++)
	{
		s_chars[(int)s_table[i].ascii]=&s_table[i].pix[0][0];
		b_chars[(int)s_table[i].ascii]=&b_table[i].pix[0][0];
	}
}

void draw_line(unsigned char *image, string text, uint x, uint y, uint width, bool big)
{
	unsigned char *image_ptr, *c_char, **chars;

	int len = text.size();
	if((x + len * 6 * (big+1)) >= width)
		len = (width - x-1)/(6 * (big+1));

	image_ptr = image + y*width + x;
	chars = big ? b_chars : s_chars;

	int line_offset      = width - 7 * (big+1);
	int next_char_offset = width * 8 * (big+1) - 6 * (big+1);

	for(int pos = 0; pos < len; pos++)
	{
		c_char = chars[(int)text[pos]];
		for(int cy = 8 * (big+1); cy; cy--)
		{
			for(int cx = 7 * (big+1); cx; cx--)
			{
				switch(*c_char)
				{
					case 1:
						*image_ptr = 0;
						break;
					case 2:
						*image_ptr = 255;
						break;
					default:
						break;
				}
				image_ptr++;
				c_char++;
			}
			image_ptr += line_offset;
		}
		image_ptr -= next_char_offset;
	}
}


//functions, declared in the header
void PrintText(unsigned char *image, string text, uint x, uint y, uint width, uint height, bool big)
{
	if(x >= width)  return;
	if(y >  height) y = height;

	const int line_space = (big + 1) * 9;
	int top_y = y;
	list<string> lines;

	/* Count the number of newlines in "text" so we scroll it up the image */
	int pos = 0;
	while((pos = text.find('\n')) != string::npos)
	{
		lines.push_back(text.substr(0,pos));
		text = text.substr(pos+1);
	}
	lines.push_back(text);

	top_y -= line_space * lines.size();
	if(top_y < 0) top_y = 0;

	while(!lines.empty() && top_y <= height - line_space)
	{
		draw_line(image, lines.front(), x, top_y, width, big);
		top_y += line_space;
		lines.pop_front();
	}
}

uint TextWidth(string text, bool big)
{
	int pos = 0;
	string biggest, cur;
	while((pos = text.find('\n')) != string::npos)
	{
		cur = text.substr(0,pos);
		if(biggest.size() < cur.size()) biggest = cur;
		text = text.substr(pos+1);
	}
	if(biggest.empty()) biggest = text;

	return biggest.size() * 6 * (big+1);
}
